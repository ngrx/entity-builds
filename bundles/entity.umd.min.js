!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store")):"function"==typeof define&&define.amd?define("@ngrx/entity",["exports","@ngrx/store"],t):t((e.ngrx=e.ngrx||{},e.ngrx.entity={}),e.ngrx.store)}(this,function(e,u){"use strict";var h={EntitiesOnly:0,Both:1,None:2};function t(r){return function(e,t){var n={ids:t.ids.slice(),entities:Object.assign({},t.entities)},i=r(e,n);return i===h.Both?Object.assign({},t,n):i===h.EntitiesOnly?Object.assign({},t,{entities:n.entities}):t}}function c(l){function s(e,t){var n=l(e);return n in t.entities?h.None:(t.ids.push(n),t.entities[n]=e,h.Both)}function d(e,t){for(var n=!1,i=0,r=e;i<r.length;i++){n=s(r[i],t)!==h.None||n}return n?h.Both:h.None}function n(e,t){var n=0<e.filter(function(e){return e in t.entities}).map(function(e){return delete t.entities[e]}).length;return n&&(t.ids=t.ids.filter(function(e){return e in t.entities})),n?h.Both:h.None}function f(e,c){var a={};return 0<(e=e.filter(function(e){return e.id in c.entities})).length?0<e.filter(function(e){return t=a,n=e,r=(i=c).entities[n.id],s=Object.assign({},r,n.changes),o=l(s),(u=o!==n.id)&&(t[n.id]=o,delete i.entities[n.id]),i.entities[o]=s,u;var t,n,i,r,s,o,u}).length?(c.ids=c.ids.map(function(e){return a[e]||e}),h.Both):h.EntitiesOnly:h.None}function i(e,t){for(var n=[],i=[],r=0,s=e;r<s.length;r++){var o=s[r],u=l(o);u in t.entities?i.push({id:u,changes:o}):n.push(o)}var c=f(i,t),a=d(n,t);switch(!0){case a===h.None&&c===h.None:return h.None;case a===h.Both||c===h.Both:return h.Both;default:return h.EntitiesOnly}}return{removeAll:function(e){return Object.assign({},e,{ids:[],entities:{}})},addOne:t(s),addMany:t(d),addAll:t(function(e,t){return t.ids=[],t.entities={},d(e,t),h.Both}),updateOne:t(function(e,t){return f([e],t)}),updateMany:t(f),upsertOne:t(function(e,t){return i([e],t)}),upsertMany:t(i),removeOne:t(function(e,t){return n([e],t)}),removeMany:t(n)}}function a(l,a){var e=c(l);function d(e,t){var n=e.filter(function(e){return!(l(e)in t.entities)});return 0===n.length?h.None:(o(n,t),h.Both)}function f(e,n){var t=[],i=0<e.filter(function(e){return function(e,t,n){if(!(t.id in n.entities))return!1;var i=n.entities[t.id],r=Object.assign({},i,t.changes),s=l(r);return delete n.entities[t.id],e.push(r),s!==t.id}(t,e,n)}).length;if(0===t.length)return h.None;var r=n.ids,s=[];return n.ids=n.ids.filter(function(e,t){return e in n.entities||(s.push(t),!1)}),o(t,n),!i&&s.every(function(e){return n.ids[e]===r[e]})?h.EntitiesOnly:h.Both}function n(e,t){for(var n=[],i=[],r=0,s=e;r<s.length;r++){var o=s[r],u=l(o);u in t.entities?i.push({id:u,changes:o}):n.push(o)}var c=f(i,t),a=d(n,t);switch(!0){case a===h.None&&c===h.None:return h.None;case a===h.Both||c===h.Both:return h.Both;default:return h.EntitiesOnly}}function o(e,n){e.sort(a);for(var t=[],i=0,r=0;i<e.length&&r<n.ids.length;){var s=e[i],o=l(s),u=n.ids[r],c=n.entities[u];a(s,c)<=0?(t.push(o),i++):(t.push(u),r++)}i<e.length?n.ids=t.concat(e.slice(i).map(l)):n.ids=t.concat(n.ids.slice(r)),e.forEach(function(e,t){n.entities[l(e)]=e})}return{removeOne:e.removeOne,removeMany:e.removeMany,removeAll:e.removeAll,addOne:t(function(e,t){return d([e],t)}),updateOne:t(function(e,t){return f([e],t)}),upsertOne:t(function(e,t){return n([e],t)}),addAll:t(function(e,t){return t.entities={},t.ids=[],d(e,t),h.Both}),addMany:t(d),updateMany:t(f),upsertMany:t(n)}}h[h.EntitiesOnly]="EntitiesOnly",h[h.Both]="Both",h[h.None]="None",e.createEntityAdapter=function(e){void 0===e&&(e={});var t=Object.assign({sortComparer:!1,selectId:function(e){return e.id}},e),n=t.selectId,i=t.sortComparer,r={getInitialState:function(e){return void 0===e&&(e={}),Object.assign({ids:[],entities:{}},e)}},s={getSelectors:function(e){var t=function(e){return e.ids},n=function(e){return e.entities},i=u.createSelector(t,n,function(e,t){return e.map(function(e){return t[e]})}),r=u.createSelector(t,function(e){return e.length});return e?{selectIds:u.createSelector(e,t),selectEntities:u.createSelector(e,n),selectAll:u.createSelector(e,i),selectTotal:u.createSelector(e,r)}:{selectIds:t,selectEntities:n,selectAll:i,selectTotal:r}}},o=i?a(n,i):c(n);return Object.assign({selectId:n,sortComparer:i},r,s,o)},Object.defineProperty(e,"__esModule",{value:!0})});